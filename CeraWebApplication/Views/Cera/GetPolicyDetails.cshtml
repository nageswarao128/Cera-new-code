@model List<CeraPolicies>

@{
    Layout = "~/Views/Shared/_ResourcesLayout.cshtml";
    //ViewData["Title"] = "Login";
}
<div class="row">
    <div class="col-md-4">
        <ul class="cera-breadCrumb">
            <li><a asp-controller="Cera" asp-action="DashBoard">Home </a></li>
            <li><a href="#">Resources</a></li>
            <li>Policies</li>
        </ul>
    </div>
</div>

<style>
    #popUp {
        display: none;
        position: fixed;
        z-index: 33;
        padding-top: 100px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
    }

    #popUpContent {
        background-color: #fefefe;
        margin: auto;
        padding: 30px;
        border: none;
        width: 680px;
        position: relative;
    }

    #multiSelect {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border-top: 1px solid #ddd;
        width: 680px;
    }

    .close {
        color: #000;
        float: right;
        font-size: 40px;
        font-weight: 100;
        margin-top: -20px;
        margin-bottom: 20px;
    }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

    .img-size {
        max-width: 20px;
    }

    .btn-danger {
        border-radius: 10px;
    }
</style>
<div class="cera-rightContent">
    <h3 class="main_h">Policies List</h3>
    <div class="row">
        <div class="col-md-9">

        </div>
        <div class="col-md-3">
            <button id="btnAddPolicy" class="btn btn-default btn-addPol" style="margin-bottom:1%">Add Policy</button>
        </div>
    </div>
    @if (Model != null)
    {
    <input style="width:30%" class="form-control" id="myInput" type="text" placeholder="Search..">
    <table class="table table-striped table-hover sortable" style="margin-top:1%">
        <thead>
            <tr>

                <th>
                    Policy Name
                </th>
                <th></th>

            </tr>
        </thead>
        <tbody id="myTable">
            @foreach (var item in Model)
                {
            <tr>
                <td type="button" data-toggle="modal" data-target="#myModal">
                    @Html.DisplayFor(modelItem => item.PrincipleName)
                </td>
                <td>
                    <img class="img-size" src="~/img/AvailabilityYellow.png" />
                </td>

            </tr>

                }
        </tbody>
    </table>
    }
    <!-- The Modal -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    @*<h4 class="modal-title"></h4>*@
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>
                                    Resource Group
                                </th>
                                <th>
                                    Resource
                                </th>
                                <th>
                                    Compliance
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    QRestApi
                                </td>
                                <td>
                                    Cera
                                </td>
                                <td>
                                    <img class="img-size" src="~/img/Correct.png" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Quadbilling
                                </td>
                                <td>
                                    QbillDB
                                </td>
                                <td>
                                    <img class="img-size" src="~/img/Wrong.png" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>
    <hr />
    <table class="table table-striped table-hover sortable" style="margin-top:1%">
        <thead>
            <tr>

                <th>
                    Subscription
                </th>

                <th>
                    Policy Rule
                </th>

            </tr>
        </thead>
        <tbody id="myTable">
            @foreach (var item in ViewBag.policyRules)
            {
            <tr>
                <td>
                    @item.subscriptionName
                </td>
                <td>
                    @item.policyRule
                </td>

            </tr>
            }
        </tbody>
    </table>
</div>
<div id="popUp">
    <div id="popUpContent">
        <span class="close">&times;</span>
        <select id="select" class="form-control" onchange="DrpChange()">
            <option value="0">--Select Subscription--</option>
            @foreach (var item in ViewBag.subscriptions)
            {
            <option value="@item.DisplayName">@item.DisplayName</option>
            }
        </select>
    </div>

    <div id="multiSelect" style="display:none">

        <div>
            <input type="checkbox" id="box1" value="Cost Should not Exceed more than 5000" name="options" />
            <label for="box1">Cost Should not Exceed more than 5000</label>
        </div>
        <div>
            <input id="box2" type="checkbox" value="Availability State of Resources should not be less than 50%" name="options" />
            <label for="box2">Availability State of Resources should not be less than 50%</label>
        </div>
        <button class="btn btn-default btn-submit mt-4" id="btnSubmit">Submit</button>
    </div>

</div>
<script src="~/js/tables.js"></script>
<script src="~/js/sort.js"></script>

<script>
    var modal = document.getElementById("popUp");

    var btn = document.getElementById("btnAddPolicy");

    var span = document.getElementsByClassName("close")[0];

    btn.onclick = function () {
        modal.style.display = "block";
    }

    span.onclick = function () {
        modal.style.display = "none";
    }
    window.onload = function () {
        subscriptiondata();
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";

        }

    }
    function DrpChange() {
        let val = $('#select').val();
        if (val != 0) {
            $('#multiSelect').show();
        }
    }
    $('#btnSubmit').click(function () {
        let subscriptionName = $('#select').val();
        let selectedOptions = [];
        let rules = $("input[name='options']:checked");
        for (let i = 0; i < rules.length; i++) {
            selectedOptions.push({ 'subscriptionName': subscriptionName, 'policyRule': $(rules[i]).val() });
        }
        console.log(selectedOptions);
        $.ajax({
            async: true,
            type: "POST",
            url: "/Cera/AddPolicyRules",
            data: { data: selectedOptions },
            //dataType: "json",
            //contentType: "application/json; charset=utf-8",
            success: function (data) {
                location.reload();

            },
            //error: function (err) {
            //    console.log(err.responseText);
            //}
        });
    });

</script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#example').DataTable();
    });
</script>
<script type="text/javascript">
    (function () {
        $('.toggle-wrap').on('click', function () {
            $(this).toggleClass('active');
            $('.cera-col3, .cera-col9').toggleClass('menu-open');
        });
    })();
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })

     var cloud;
    var data = [];
    var dataarr = [];
    var clouddata = [];
     function getdataCloud() {
        debugger;
        cloud = $('#ddlCloud').val();
        console.log('selected cloud', cloud);
        let subscriptionid = $('#ddlSub').val();
        if (subscriptionid == "AllSubscriptions") {
            if (cloud == "AllClouds") {
                $('#subscriptionFilter').hide();
                debugger;
                clouddata = [];
                clouddata = this.JSON.parse('@Html.Raw(Json.Serialize(ViewBag.data))');
                console.log('AllCloudsdata', clouddata);
                appendhtmldata(clouddata);
            }
            else if (cloud == "Azure") {
                $('#subscriptionFilter').show();
                data = [];
                dataarr = [];
                data = this.JSON.parse('@Html.Raw(Json.Serialize(ViewBag.data))');
                dataarr = data.filter(function (data) {
                    return data.cloudProvider == cloud;

                });
                console.log('Selectedcloud', dataarr);
                appendhtmldata(dataarr);
            }

            else {
                $('#subscriptionFilter').hide();
                data = [];
                dataarr = [];
                data = this.JSON.parse('@Html.Raw(Json.Serialize(ViewBag.data))');
                dataarr = data.filter(function (data) {
                    return data.cloudProvider == cloud;

                });
                console.log('Selectedcloud', dataarr);
                appendhtmldata(dataarr);
            }
        }
        else {
            if (cloud == "AllClouds") {
                $('#subscriptionFilter').hide();
                debugger;
                clouddata = [];
                clouddata = this.JSON.parse('@Html.Raw(Json.Serialize(ViewBag.data))');
                console.log('AllCloudsdata', clouddata);
                appendhtmldata(clouddata);
            }
            else if (cloud == "Azure") {
                $('#subscriptionFilter').show();
                data = [];
                dataarr = [];
                data = this.JSON.parse('@Html.Raw(Json.Serialize(ViewBag.data))');
                dataarr = data.filter(function (data) {
                    return data.cloudProvider == cloud && data.subscriptionId == subscriptionid;

                });
                console.log('Selectedcloud', dataarr);
                appendhtmldata(dataarr);
            }

            else {
                $('#subscriptionFilter').hide();
                data = [];
                dataarr = [];
                data = this.JSON.parse('@Html.Raw(Json.Serialize(ViewBag.data))');
                dataarr = data.filter(function (data) {
                    return data.cloudProvider == cloud;

                });
                console.log('Selectedcloud', dataarr);
                appendhtmldata(dataarr);
            }
        }

    }
    function getDataBySubscription() {
        getdataCloud();
    }

    function appendhtmldata(data) {
        console.log('appendhtmlhit');
        if (data != null) {

            let html = '';
            debugger;

            for (let i = 0; i < data.length; i++) {
                html += '<tr>';
                html += '<td>' + data[i].principleName + '</td>';
                html += '<td>' + data[i].resourceGroupName + '</td>';

                html += '</tr>';
            }
            $('#myTable').empty();
            $('#myTable').append(html);

        }
    }

</script>
